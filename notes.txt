from M2Crypto import RSA, X509
from base64 import b64encode

INITIATOR_PASS = "YOUR_PASSWORD"
CERTIFICATE_FILE = "PATH_TO_CERTIFICATE_FILE"


def encryptInitiatorPassword():
    cert_file = open(CERTIFICATE_FILE, 'r')
    cert_data = cert_file.read()  # read certificate file
    cert_file.close()

    cert = X509.load_cert_string(cert_data)
    # pub_key = X509.load_cert_string(cert_data)
    pub_key = cert.get_pubkey()
    rsa_key = pub_key.get_rsa()
    cipher = rsa_key.public_encrypt(INITIATOR_PASS, RSA.pkcs1_padding)
    return b64encode(cipher)


print
encryptInitiatorPassword()


post = {
            "MerchantRequestID": data["Body"]["stkCallback"]["MerchantRequestID"],
            "CheckoutRequestID": data["Body"]["stkCallback"]["CheckoutRequestID"],
            "ResultCode": data["Body"]["stkCallback"]["ResultCode"],
            "ResultDesc": data["Body"]["stkCallback"]["ResultDesc"],
            "Amount": data["Body"]["stkCallback"]["CallbackMetadata"]["Item"][0]["Value"],
            "MpesaReceiptNumber": data["Body"]["stkCallback"]["CallbackMetadata"]["Item"][1]["Value"],
            "Balance": 0,
            "TransactionDate": data["Body"]["stkCallback"]["CallbackMetadata"]["Item"][3]["Value"],
            "PhoneNumber": data["Body"]["stkCallback"]["CallbackMetadata"]["Item"][4]["Value"]
        }
